-- Southwind

-- Southwind database

-- 1.The table tpurcd gives details of all products ordered. This table gives details of all purchase orders.

SELECT *
  FROM tcust
  JOIN tpurcd ON (tcust.code=tpurcd.cust)
  JOIN tprod  ON (tpurcd.prod=tprod.code)

-- 2.Some of the tables are joined by a composite foreign key. For example to link shipment details to a shipment record we must join on (cust,shpd).

SELECT addr, tship.shpd, prod
   FROM tship JOIN tshipd
     ON(tshipd.cust=tship.cust AND
        tshipd.shpd=tship.shpd)
 WHERE tship.addr IS NOT NULL

-- Southwind easy

-- Southwind database: easy questions

-- 1.List all the products ordered by customer c006. Include the description of the product, the date that the order was received and the number ordered.

select tprod.code, dscr,recv, qnty
from tprod
join tpurcd on tpurcd.prod=tprod.code
join tcust on tcust.code=tpurcd.cust
where tcust.code='c006'
order by tprod.code, recv Asc

-- Result:
code	dscr	recv	qnty
p003	Bennington	Fri, 08 Feb 2002 00:00:00 GMT	5
p004	Lexington	Sat, 16 Feb 2002 00:00:00 GMT	1
p004	Lexington	Wed, 20 Feb 2002 00:00:00 GMT	4
p005	Wilmington	Sat, 26 Jan 2002 00:00:00 GMT	1
p005	Wilmington	Fri, 08 Feb 2002 00:00:00 GMT	2
p005	Wilmington	Wed, 20 Feb 2002 00:00:00 GMT	4
p006	Farmington	Sat, 16 Feb 2002 00:00:00 GMT	2
p007	Arlington	Wed, 20 Feb 2002 00:00:00 GMT	5
p008	Huntington	Sat, 26 Jan 2002 00:00:00 GMT	2
p008	Huntington	Wed, 20 Feb 2002 00:00:00 GMT	4
p010	Coddington	Sat, 26 Jan 2002 00:00:00 GMT	15

-- 2.For each product show the total number ordered. Include just the product code and the number ordered

select tprod.code, coalesce(sum(qnty),0)
from tprod
left join tpurcd on tpurcd.prod=tprod.code
group by tprod.code
order by tprod.code

-- Result:
code	coalesce(sum(..
p001	21
p002	0
p003	16
p004	20
p005	25
p006	19
p007	14
p008	37
p009	0
p010	27

-- 3.Give the firm and the address of each company that placed an order on 12th February 2007.

select distinct(firm), addr
from tpurcd
join tcust on tcust.code=tpurcd.cust
where date_format(recv, '%Y-%m-%d') = '2002-02-12'

-- Result:
firm	addr
Inconspicuous Inc.	Interception Rd.
Contiguous Corp.	Circumscription Close
Assiduous Assoc.	Attribution Alley

-- 4.Give all details of the order made by customer 'Assiduous Assoc.' on 12th February 2007. Include the product code, the description the price and the number ordered.

select prod, dscr, pric, qnty
from tpurcd
join tcust on tcust.code=tpurcd.cust
join tprod on tprod.code=tpurcd.prod
where date_format(recv, '%Y-%m-%d') = '2002-02-12' and firm = 'Assiduous Assoc.' 

-- Result:
prod	dscr	pric	qnty
p001	Kensington	20.00	1
p008	Huntington	30.00	5

-- 5.Find the total number of 'Wilmington' ordered by 'Contiguous Corp.'.

select sum(qnty)
from tpurcd
join tcust on tcust.code=tpurcd.cust
join tprod on tprod.code=tpurcd.prod
where dscr='Wilmington' and firm = 'Contiguous Corp.' 

-- Result:
sum(qnty)
10

-- Southwind medium

-- Southwind database: medium questions

-- 1.Give the name of the firm or firms who have placed no orders.

select firm
from tcust
left join tpurcd on tpurcd.cust=tcust.code
where cust is NULL

-- Result:
firm
Strenuous Systems

-- 2.Create a list of products. For each product show the description and the total number ordered and the date of the most recent order.

select dscr, coalesce(sum(qnty),0) TNO, coalesce(max(recv), 'No orders') RecentOrdrDate
from tprod
left join tpurcd on tpurcd.prod=tprod.code
group by dscr

-- Result:
dscr	TNO	RecentOrdrDate
Arlington	14	2002-02-20
Barrington	0	No orders
Bennington	16	2002-02-17
Coddington	27	2002-02-17
Farmington	19	2002-02-17
Huntington	37	2002-02-20
Kensington	21	2002-02-17
Lexington	20	2002-02-20
Wilmington	25	2002-02-20
Worthington	0	No orders

-- 3.Show the customer code, the received date and the total value of all purchase orders with a total value of at least Â£475.

select tcust.code, recv, sum(qnty*pric) TV
from tcust
join tpurcd on tpurcd.cust=tcust.code
join tprod on tpurcd.prod=tprod.code
group by tcust.code, recv
having TV>=475

-- Result:
code	recv	TV
c002	Tue, 12 Feb 2002 00:00:00 GMT	475.00
c003	Sun, 17 Feb 2002 00:00:00 GMT	565.00

-- 4.List all shipments for the first week of February (2007-02-01 to 2007-02-07 inclusive). For each shipment show: the customer, the date of the shipment and the address. The address is the customer address as in tcust unless specified in tship

select firm Customer, date_format(shpd,'%Y-%m-%d') Shpmnt_Date, if(s.addr is not NULL, s.addr, c.addr) Address
from tship s
join tcust c on c.code=s.cust
where date_format(shpd,'%Y-%m-%d') between '2002-02-01' and '2002-02-07'

-- Result:
Customer	Shpmnt_Date	Address
Contiguous Corp.	2002-02-03	Circumscription Close
Contiguous Corp.	2002-02-05	Circumscription Close
Assiduous Assoc.	2002-02-07	Diminution Drive

-- 5.Show the total sales by month.

select date_format(recv,'%M-%Y') Month, sum(pric*qnty) TotalSales
from tprod
join tpurcd on tprod.code=tpurcd.prod
group by Month Desc

-- Result:
Month	TotalSales
January-2002	585.00
February-2002	3515.00

